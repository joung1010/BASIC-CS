## VPN의 기본 개념

**VPN에서 V는 Virtual이다. 그래서 Virtual + Private Network가 VPN이다. 그러면 앞서 배운 NAT에서 보았던 private 네트워크와 동일할까? 그렇지는 않고 이를 번역하면 사설망이라고 해서 가상 사설망을 말한다. 그러면 이 사설망은 쉽게 말해서 LAN 정도 생각하면 된다. 이때 LAN은 물리적으로 통제가 되는 범위에서의 네트워크를 말한다. 예를 들어 집이 있다 이 집은 private하고 이 현관문을 열고 나가면 외부(public)가 된다**.

VPN에서 말하는 Private Network는 앞서 학습한 NAT의 사설 IP 대역과는 다른 개념입니다. **NAT의 private 네트워크는 단순히 IP 주소 체계의 분류**였다면, **VPN의 private 네트워크는 물리적으로 통제되고 보안이 보장되는 네트워크 환경**을 의미합니다.

물리적인 LAN에서는 모든 네트워크 장비와 케이블이 특정 조직의 통제 하에 있습니다. 외부인이 물리적으로 접근하기 어렵고, 네트워크 트래픽이 조직 외부로 노출되지 않습니다. 하지만 이런 물리적 LAN을 지리적으로 멀리 떨어진 곳까지 확장하려면 엄청난 비용과 복잡성이 따릅니다.

```
물리적 Private Network vs 가상 Private Network:

물리적 LAN:
서울 본사 ─── 전용선 ─── 부산 지사
- 물리적 케이블 직접 연결
- 완전한 보안 보장
- 높은 비용, 복잡한 구축

가상 LAN (VPN):
서울 본사 ─── 인터넷(암호화) ─── 부산 지사
- 기존 인터넷 인프라 활용
- 암호화를 통한 보안
- 저렴한 비용, 간편한 구축
```

## VPN이 필요한 이유

**그러면 이 private한 네트워크를 왜 사용하는 것일까??**

**우리가 인터넷이라고 말하는 네트워크는 전세계적인 완벽한 퍼블릭이다. 이 네트워크를 구현하고자 TCP/IP 같은 기술을 구현하고 있지만 이 인터넷은 전세계의 공용공간, 마치 공원처럼 공공재와 유사하다. 그래서 이 열린 공간을 같이 활용하는 것도 좋은데 어떤 사적 행동을 이 열린 공간에서 할 수 없다. 특히 보안성이 요구되는 경우에는 더욱 더 그럴 것이다**.

인터넷의 근본적인 특성을 이해하는 것이 중요합니다. **인터넷은 best-effort 방식의 패킷 전달 네트워크**입니다. 패킷이 출발지에서 목적지까지 가는 동안 수많은 라우터와 ISP를 거치게 되는데, 이 과정에서 패킷의 내용이 노출될 가능성이 있습니다.

예를 들어, 서울에서 부산으로 패킷을 보낼 때 실제 경로는 다음과 같을 수 있습니다: 서울 → KT 백본 → 대전 중계소 → 대구 중계소 → 부산. 이 경로상의 모든 라우터에서는 이론적으로 패킷 내용을 볼 수 있습니다.

**그래서 private network라고 하는 것은 보안성이 요구되는 사설, 즉 우리 회사 네트워크, 그래서 물리적으로 통제가 된다. 우리밖에 사용하지 못한다**.

## 기업 네트워크 확장의 문제

**만약에 어떤 회사가 서울에 본사를 두고 있고 내부 직원들이 매출 데이터 DB를 두고 이에 대한 통계 작업을 한다. 근데 사업이 확장되면서 부산에 지사를 내고 부산에서도 이 서울에 있는 매출 데이터에 접근할 필요성이 생겼을 때 어떻게 부산에 있는 지사가 본사에 있는 네트워크에 안전하게 접근할 수 있을까?**

이는 많은 기업이 직면하는 현실적인 문제입니다. 기업이 성장하면서 지사, 지점, 원격 근무자들이 늘어나는데, 이들 모두가 본사의 핵심 시스템에 안전하게 접근해야 합니다.

전통적인 해결 방법들과 그 한계를 살펴보겠습니다:

**전용선 구축 방법**: ISP에게 서울과 부산 간 전용 통신 회선을 요청합니다. 이는 물리적으로 분리된 회선이므로 보안이 뛰어나지만, 월 수백만 원에서 수천만 원의 비용이 듭니다. 또한 회선 구축에 수개월이 걸리고, 장애 발생 시 복구가 어렵습니다.

**MPLS 네트워크**: ISP가 제공하는 관리형 네트워크 서비스입니다. 보안과 QoS가 보장되지만 역시 높은 비용이 들고, 새로운 지점 추가 시 복잡한 설정이 필요합니다.

**그래서 부산 지사에서 서울 본사까지 데이터에 대한 접근할 때 인터넷을 이용하자니 퍼블릭이라 노출에 대한 위험성이 있다. 그러면 보통 ISP 회사에 다가 서울 본사와 부산에 있는 지사만 사용할 수 있게 Private Network로 연결해줘 거기를 LAN으로 묶고 싶어라고 부탁하면 된다. 근데 이런 식으로 하면 속도뿐만 아니라 비용적으로도 많은 부담을 가진다. 인터넷이 빠르고 가격도 저렴한데 단 하나 보안상의 문제가 있어서 이를 해결하고자 나온 것이 VPN이다**.

## VPN의 핵심 아이디어

**그래서 Private Network를 확장해서 사용하면 좋지만 이 인터넷이라는 오픈된 네트워크를 인프라로 쓰는데 Private Network처럼 보안성을 확장해서 사용하는 네트워크 기술이다. 즉 퍼블릭망을 논리적으로 프라이빗하게 만들어주는 기능이다**.

VPN의 혁신적인 아이디어는 **기존 인터넷 인프라를 그대로 활용하면서도 전용선과 같은 보안성을 제공**한다는 것입니다. 이는 소프트웨어적인 해결책으로 하드웨어의 한계를 극복한 대표적인 사례입니다.

```
VPN의 핵심 개념:

물리적 관점:
[서울 본사] ── 인터넷 (Public) ── [부산 지사]

논리적 관점:
[서울 본사] ── 가상 터널 (Private) ── [부산 지사]
                ↑
            암호화된 연결로
            외부에서는 내용을 
            볼 수 없음
```

**그러면 어떻게 가능할까? 간단하다 암호화하고 인증을 하면 된다**.

## VPN의 핵심 보안 기술

**그래서 무결성(디지털 서명 해시 알고리즘) + 기밀성(암호화 기술)을 통해서 설령 남이 본다 하더라도 암호화되어 있기 때문에 알아볼 수 없다**.

VPN이 제공하는 보안 서비스는 정보보안의 3대 요소를 모두 포함합니다:

**기밀성(Confidentiality)**: 암호화를 통해 데이터 내용을 보호합니다. AES, ChaCha20 같은 대칭키 암호화 알고리즘을 사용하여 실제 데이터를 암호화합니다. 중간에 패킷을 가로채더라도 암호화된 내용만 보이므로 원본 데이터를 알 수 없습니다.

**무결성(Integrity)**: 디지털 서명과 해시 함수를 통해 데이터가 전송 중에 변조되지 않았음을 보장합니다. HMAC-SHA256 같은 메시지 인증 코드를 사용하여 패킷이 위조되거나 변조되었는지 검증합니다.

**인증(Authentication)**: 통신 상대방이 정말 믿을 수 있는 상대인지 확인합니다. 인증서, 사전 공유 키(PSK), 사용자 ID/PW 등 다양한 방법으로 상대방의 신원을 확인합니다.

```
VPN 보안 처리 과정:

원본 데이터: "매출 데이터: 100억원"
    ↓
1. 해시 생성: SHA256(원본 데이터) = "a1b2c3d4..."
2. 암호화: AES(원본 데이터 + 해시) = "x9y8z7w6..."
3. 헤더 추가: VPN 헤더 + 암호화된 데이터
    ↓
전송 패킷: [VPN 헤더][암호화된 데이터]
    ↓
수신측에서 역과정:
1. 복호화: "매출 데이터: 100억원" + "a1b2c3d4..."
2. 해시 검증: SHA256("매출 데이터: 100억원") == "a1b2c3d4..."
3. 검증 성공 → 데이터 전달
```

## 터널링 기술

**근데 이 암호화하는 기술, 남이 봐도 모른다 라고 하면 좋은데 이를 전문 용어로 터널링이라고 한다. 그래서 이 터널링의 핵심 기술은 무결성과 기밀성이다**.

터널링은 VPN의 가장 핵심적인 개념입니다. **터널링은 한 프로토콜의 패킷을 다른 프로토콜로 감싸서 전송하는 기술**입니다. 마치 소포를 상자에 넣어서 배송하는 것과 비슷합니다.

구체적인 터널링 과정을 살펴보겠습니다:

**캡슐화(Encapsulation)**: 원본 IP 패킷을 VPN 헤더로 감쌉니다. 이때 원본 패킷은 암호화되고, 새로운 IP 헤더가 추가됩니다. 외부에서는 VPN 게이트웨이 간의 통신으로만 보입니다.

**전송**: 캡슐화된 패킷이 인터넷을 통해 전송됩니다. 중간 라우터들은 바깥쪽 IP 헤더만 보고 라우팅하므로, 내부의 실제 목적지나 데이터 내용을 알 수 없습니다.

**역캡슐화(Decapsulation)**: 목적지 VPN 게이트웨이에서 바깥쪽 헤더를 제거하고 암호화된 패킷을 복호화하여 원본 패킷을 복원합니다.

```
터널링 패킷 구조:

일반 IP 패킷:
[IP 헤더][TCP 헤더][데이터]

VPN 터널링 패킷:
[새 IP 헤더][VPN 헤더][암호화된 원본 패킷]
     ↑           ↑            ↑
 게이트웨이간   터널 정보    원본 통신 내용
   라우팅       (암호화)      (보호됨)
```

**또 재택근무를 할 때 개인 PC에서 회사의 네트워크에 접속할 때도 VPN이 사용된다**.

이는 특히 코로나19 이후 원격근무가 확산되면서 더욱 중요해진 시나리오입니다. 집에서 회사 내부 시스템에 접근할 때 VPN 없이는 보안상 매우 위험합니다.

## VPN의 핵심 기술 구성요소

**보안 서비스 기술: 내부 사설망을 외부로부터 스스로 보호하고, 사용자 인증을 통한 접근 통제가 가능해야 한다**.

이는 VPN 게이트웨이에서 구현되는 기능들입니다. 방화벽 기능, 침입 탐지 시스템(IDS), 접근 제어 목록(ACL) 등이 포함됩니다. 또한 사용자별, 그룹별로 접근 가능한 리소스를 세밀하게 제어할 수 있습니다.

**데이터 인증 및 암호화 기술: 사설망 간의 트래픽을 무결성과 기밀성을 유지하기 위해서, 모든 트래픽에 인증 메커니즘을 적용하거나, 정보 유출 방지를 위해서 암호화할 수 있어야 한다**.

현대 VPN에서 사용되는 주요 암호화 알고리즘들은 다음과 같습니다:

- **대칭키 암호화**: AES-256, ChaCha20 (빠른 데이터 암호화)
- **비대칭키 암호화**: RSA, ECDSA (키 교환 및 인증)
- **해시 함수**: SHA-256, SHA-3 (무결성 검증)
- **메시지 인증**: HMAC (변조 탐지)

**터널링 기술: 기존 공개 네트워크에서 가상의 사설망을 구성하기 위해서, 기존 네트워크에서 정보 이동이 가능하도록 정보를 캡슐화하고, 다시 풀어내어 논리적으로 두 네트워크를 연결하는 기술(망연계)이다**.

터널링 프로토콜의 종류와 특징을 살펴보면:

**IPSec**: IP 계층에서 동작하는 터널링 프로토콜입니다. ESP(Encapsulating Security Payload)와 AH(Authentication Header)를 사용하여 강력한 보안을 제공합니다.

**OpenVPN**: SSL/TLS를 기반으로 하는 오픈소스 VPN 프로토콜입니다. 방화벽 통과가 쉽고 설정이 유연합니다.

**WireGuard**: 최신 VPN 프로토콜로, 기존 프로토콜보다 훨씬 간단하고 빠른 성능을 제공합니다.

```
VPN 프로토콜별 특징:

IPSec:
- 장점: 강력한 보안, 하드웨어 가속 지원
- 단점: 설정 복잡, NAT 통과 어려움

OpenVPN:
- 장점: 방화벽 통과 용이, 유연한 설정
- 단점: 상대적으로 느린 성능

WireGuard:
- 장점: 간단한 설정, 빠른 성능
- 단점: 상대적으로 새로운 기술
```

이러한 VPN 기술을 통해 기업들은 물리적인 전용선 없이도 안전하고 경제적인 네트워크 확장이 가능해졌으며, 원격근무와 클라우드 시대의 핵심 인프라가 되었습니다.