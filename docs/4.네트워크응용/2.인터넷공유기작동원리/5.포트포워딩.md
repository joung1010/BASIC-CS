# 포트 포워딩

## 포트 포워딩의 필요성

```
                         Private IP 192.168.0.1
 192.168.0.10            Global IP   3.3.3.3                    15.15.15.15
 PC ─────────────────── NAT Gateway ──────── Public Internet ──Web Server
                                                             │
                                                             │       9.9.9.9
                                                             │───── Web Server

NAT Table

Local IP    │ Local Port │ External Port │ Remote IP   │ Remote Port │ Protocol
192.168.0.10│    3000    │     23000     │15.15.15.15  │    80       │   TCP
192.168.0.10│    2500    │     23001     │15.15.15.15  │    80       │   TCP
192.168.0.10│    4000    │     23002     │15.15.15.15  │    80       │   TCP
```

**기본적으로 NAT를 쓴다고 했을 때 안쪽 내부에는 주로 클라이언트가 있다고 가정한다. 그래서 기본적으로 외부에서 안쪽으로 들어오는 경우를 크게 고려하지 않는다. 하지만 이런 경우도 고려되어야 할 때가 존재하기 때문에 이러한 문제를 해결하기 위해서 여러 노력들이 있는데 가장 기본적으로는 NAT 테이블을 직접 수정하는 방식이 있다**.

**이 NAT 테이블에 추가가 되려면 Outbound가 발생해야 자동으로 추가가 되는데 만약에 이를 직접 수정하게 해준다면 어떻게 될까? 이러한 방식을 포트 포워딩이라고 한다**.

```
NAT의 기본 한계와 해결책:

기본 NAT 동작의 한계:
┌─────────────────────────────────────────────────┐
│ 문제 상황:                                      │
│ • 내부에 웹서버나 게임 서버 운영하고 싶음       │
│ • 외부에서 내부 서비스에 직접 접근 필요         │
│ • P2P 애플리케이션의 서버 역할                  │
│                                                 │
│ NAT의 제약:                                     │
│ • Outbound 연결만 자동 허용                    │
│ • Inbound 연결은 기존 연결에 대한 응답만 허용   │
│ • 새로운 외부 연결 시작 불가                    │
└─────────────────────────────────────────────────┘

포트 포워딩 해결 방식:
┌─────────────────────────────────────────────────┐
│ 수동 NAT 규칙 생성:                             │
│ • 관리자가 미리 NAT 테이블 엔트리 생성          │
│ • 특정 포트로 들어오는 모든 트래픽 전달         │
│ • Outbound 트리거 없이도 Inbound 허용           │
│                                                 │
│ 정적 매핑:                                      │
│ • 동적 NAT와 달리 고정된 포트 매핑              │
│ • 영구적인 설정 (재부팅 후에도 유지)            │
│ • 예측 가능한 접근 경로                         │
└─────────────────────────────────────────────────┘

실제 사용 사례:
┌─────────────────────────────────────────────────┐
│ 서버 호스팅:                                    │
│ • 개인 웹서버 운영                              │
│ • 게임 서버 호스팅                              │
│ • FTP 서버 운영                                │
│                                                 │
│ 원격 접근:                                      │
│ • SSH 원격 접속                                │
│ • 원격 데스크톱 (RDP)                          │
│ • VPN 서버 접근                                │
│                                                 │
│ P2P 애플리케이션:                               │
│ • BitTorrent 시딩                              │
│ • 게임 방 호스팅                                │
│ • 화상회의 서버 역할                            │
└─────────────────────────────────────────────────┘
```

## 공유기 설정과 포트 포워딩

그래서 **가장 흔하게 사용하는 ipTIME 공유기 설정 메뉴를 보면 포트 포워딩 설정이라고 있다**.

**해당 설정을 보면 규칙 이름, 내부 IP, 프로토콜, 외부 포트, 내부 포트 이렇게 있다**.

```
Local IP    │ Local Port │ External Port │ Remote IP   │ Remote Port │ Protocol
192.168.0.12│    80      │     80        │   ANY       │    ANY      │   TCP
```

**그래서 특정 호스트에 대해 위처럼 공유기에 설정하게 되면 어떤 요청이든 80번 포트로 요청이 들어오면 해당 192.168.0.12:80으로 트래픽을 보내게 된다. 해당 공유기는 웹서버가 설치되어 있지 않지만 직접 수정한 룰, 즉 포트 포워딩 규칙에 따라서 80번으로 어떠한 트래픽이 오게 되면 192.168.0.12로 변환해서 포워딩해주게 된다**.

```
실제 공유기 설정 화면:

ipTIME 포트 포워딩 설정:
┌─────────────────────────────────────────────────┐
│ 규칙 이름: WebServer                            │
│ 내부 IP 주소: 192.168.0.12                     │
│ 프로토콜: TCP                                   │
│ 외부 포트: 80                                   │
│ 내부 포트: 80                                   │
│ 사용: ☑ 활성화                                 │
│                                                 │
│ [추가] [수정] [삭제]                           │
└─────────────────────────────────────────────────┘

다른 공유기 브랜드 용어:
┌─────────────────────────────────────────────────┐
│ • ipTIME: 포트 포워딩                          │
│ • ASUS: Virtual Server                         │
│ • TP-Link: Virtual Servers                     │
│ • Netgear: Port Forwarding                     │
│ • Linksys: Gaming Accelerator                  │
│ • D-Link: Virtual Server                       │
└─────────────────────────────────────────────────┘

설정 필드 설명:
┌─────────────────────────────────────────────────┐
│ 규칙 이름: 관리용 별칭 (사용자 정의)            │
│ 내부 IP: 트래픽을 전달받을 내부 호스트          │
│ 프로토콜: TCP, UDP, 또는 Both                   │
│ 외부 포트: 외부에서 접근할 포트 번호            │
│ 내부 포트: 내부 서비스가 실행되는 포트          │
│ IP 주소 범위: 특정 IP만 허용 (선택사항)         │
└─────────────────────────────────────────────────┘
```

## 포트 포워딩 동작 과정

```
포트 포워딩 트래픽 흐름:

1. 외부 클라이언트 접근:
┌─────────────────────────────────────────────────┐
│ 외부 클라이언트 (1.2.3.4) → 3.3.3.3:80         │
│                                                 │
│ 클라이언트 관점:                                │
│ • "3.3.3.3에서 웹서버가 실행 중"                │
│ • 실제 내부 구조는 모름                         │
│ • 일반적인 웹서버 접속과 동일                   │
└─────────────────────────────────────────────────┘

2. NAT Gateway 처리:
┌─────────────────────────────────────────────────┐
│ 포트 포워딩 규칙 조회:                          │
│ • 목적지 포트: 80                              │
│ • 매칭되는 규칙 발견                            │
│ • 내부 IP: 192.168.0.12                       │
│ • 내부 포트: 80                                │
│                                                 │
│ 패킷 변환:                                      │
│ • 원본: 1.2.3.4:12345 → 3.3.3.3:80            │
│ • 변환: 1.2.3.4:12345 → 192.168.0.12:80       │
└─────────────────────────────────────────────────┘

3. 내부 서버 응답:
┌─────────────────────────────────────────────────┐
│ 웹서버 (192.168.0.12) 처리:                    │
│ • HTTP 요청 수신 및 처리                       │
│ • 웹페이지 생성                                 │
│ • 응답 패킷 생성                                │
│                                                 │
│ 응답 경로:                                      │
│ • 192.168.0.12:80 → 1.2.3.4:12345             │
│ • NAT Gateway에서 역변환                       │
│ • 3.3.3.3:80 → 1.2.3.4:12345                  │
│ • 클라이언트에게 전달                           │
└─────────────────────────────────────────────────┘

NAT 테이블 엔트리:
┌─────────────────────────────────────────────────┐
│ 정적 엔트리 (포트 포워딩):                       │
│ Local: 192.168.0.12:80                         │
│ External: 80                                   │
│ Remote: ANY:ANY                                │
│ Type: STATIC                                   │
│ Timeout: PERMANENT                             │
│                                                 │
│ 동적 엔트리 (실제 연결):                        │
│ Local: 192.168.0.12:80                         │
│ External: 80                                   │
│ Remote: 1.2.3.4:12345                         │
│ Type: DYNAMIC                                  │
│ Timeout: 7200초                                │
└─────────────────────────────────────────────────┘
```

## P2P 통신 해결

**이러한 포트 포워딩 방식을 사용하게 되면 Symmetric이 됐든 Cone이든 Full Cone이든 뭐가 됐든 이렇게 하면 P2P 통신이 가능해진다**.

```
포트 포워딩으로 NAT 타입 무관하게 P2P 지원:

모든 NAT 타입에서 동작:
┌─────────────────────────────────────────────────┐
│ Symmetric NAT + 포트 포워딩:                    │
│ • 평소: 엄격한 보안 (Outbound만 허용)           │
│ • 포워딩: 특정 포트만 Inbound 허용              │
│ • 결과: 보안성 + P2P 가능                      │
│                                                 │
│ Full Cone + 포트 포워딩:                        │
│ • 더욱 안정적인 P2P 연결                       │
│ • 예측 가능한 포트 번호                         │
│ • 설정 간소화                                   │
└─────────────────────────────────────────────────┘

게임 서버 호스팅 예시:
┌─────────────────────────────────────────────────┐
│ 마인크래프트 서버:                              │
│ • 내부 서버: 192.168.0.100:25565               │
│ • 포트 포워딩: 외부 25565 → 내부 25565         │
│ • 친구들 접속: [공인IP]:25565                  │
│                                                 │
│ CS:GO 전용 서버:                               │
│ • 내부 서버: 192.168.0.101:27015               │
│ • 포트 포워딩: 외부 27015 → 내부 27015         │
│ • Steam 서버 브라우저에서 검색 가능             │
└─────────────────────────────────────────────────┘

화상회의 서버 운영:
┌─────────────────────────────────────────────────┐
│ Jitsi Meet 서버:                                │
│ • HTTP: 외부 80 → 내부 80                      │
│ • HTTPS: 외부 443 → 내부 443                   │
│ • WebRTC: 외부 10000 → 내부 10000              │
│                                                 │
│ 참가자들이 직접 연결:                           │
│ • 서버 부하 분산                                │
│ • 지연시간 최소화                               │
│ • 대역폭 절약                                   │
└─────────────────────────────────────────────────┘
```

## 다양한 활용 사례

```
포트 포워딩 실무 활용:

개발/테스트 환경:
┌─────────────────────────────────────────────────┐
│ 웹 개발 서버:                                   │
│ • 포트 80: Apache/Nginx 웹서버                  │
│ • 포트 3000: Node.js 개발 서버                  │
│ • 포트 8080: Tomcat 애플리케이션 서버           │
│                                                 │
│ 데이터베이스 접근:                              │
│ • 포트 3306: MySQL                             │
│ • 포트 5432: PostgreSQL                        │
│ • 포트 27017: MongoDB                          │
│                                                 │
│ 개발 도구:                                      │
│ • 포트 8081: Jenkins CI/CD                     │
│ • 포트 9000: SonarQube                         │
│ • 포트 3001: Git 서버                          │
└─────────────────────────────────────────────────┘

원격 관리:
┌─────────────────────────────────────────────────┐
│ SSH 접속:                                       │
│ • 포트 22: Linux/Unix SSH                      │
│ • 포트 2222: 보안을 위한 비표준 포트            │
│                                                 │
│ 원격 데스크톱:                                  │
│ • 포트 3389: Windows RDP                       │
│ • 포트 5900: VNC                               │
│                                                 │
│ VPN 서버:                                       │
│ • 포트 1723: PPTP                              │
│ • 포트 1194: OpenVPN                           │
│ • 포트 500: IPSec                              │
└─────────────────────────────────────────────────┘

미디어 서버:
┌─────────────────────────────────────────────────┐
│ 스트리밍 서버:                                  │
│ • 포트 1935: RTMP 스트리밍                     │
│ • 포트 8080: HTTP 스트리밍                     │
│                                                 │
│ 미디어 센터:                                    │
│ • 포트 32400: Plex Media Server                │
│ • 포트 8096: Jellyfin                          │
│ • 포트 6767: Bazarr                            │
└─────────────────────────────────────────────────┘
```

## 보안 고려사항

```
포트 포워딩 보안 위험:

주요 위험 요소:
┌─────────────────────────────────────────────────┐
│ 1. 공격 표면 확대:                              │
│   • 외부에서 직접 접근 가능한 서비스 증가       │
│   • 방화벽 우회                                 │
│                                                 │
│ 2. 서비스 노출:                                 │
│   • 포트 스캔으로 열린 서비스 발견 가능         │
│   • 취약점 공격 대상                            │
│                                                 │
│ 3. 잘못된 설정:                                 │
│   • 불필요한 포트 개방                          │
│   • 관리용 포트 노출                            │
└─────────────────────────────────────────────────┘

보안 강화 방법:
┌─────────────────────────────────────────────────┐
│ 1. 최소 권한 원칙:                              │
│   • 필요한 포트만 개방                          │
│   • 사용하지 않는 규칙 삭제                     │
│                                                 │
│ 2. 비표준 포트 사용:                            │
│   • SSH: 22 → 2222                            │
│   • RDP: 3389 → 33389                         │
│   • 자동화된 공격 회피                          │
│                                                 │
│ 3. 접근 제한:                                   │
│   • 특정 IP 대역만 허용                        │
│   • VPN 연결 후 접근                           │
│   • 강력한 인증 적용                            │
│                                                 │
│ 4. 모니터링:                                    │
│   • 접속 로그 확인                              │
│   • 이상 트래픽 탐지                            │
│   • 정기적인 보안 점검                          │
└─────────────────────────────────────────────────┘

안전한 설정 예시:
┌─────────────────────────────────────────────────┐
│ SSH 서버 (안전한 설정):                         │
│ • 포트: 2222 (비표준)                          │
│ • 허용 IP: 회사 사무실 대역만                   │
│ • 인증: 키 기반 인증                            │
│ • 시간 제한: 업무 시간만                        │
│                                                 │
│ 웹서버 (안전한 설정):                           │
│ • HTTPS만 허용 (HTTP 리다이렉트)                │
│ • 관리 페이지 별도 포트                         │
│ • 정기적인 보안 업데이트                        │
│ • 웹 애플리케이션 방화벽 연동                   │
└─────────────────────────────────────────────────┘
```

이러한 **포트 포워딩 기술**을 이해하면 **NAT 환경에서도 다양한 서버 서비스를 안전하게 운영**할 수 있고, **P2P 애플리케이션의 연결성 문제를 해결**할 수 있습니다.

# UPnP와 NAT

## UPnP의 필요성

그러면 **예를 들어 게임을 할 때마다 공유기 제조사를 알고 P2P를 하는 양쪽 단말기에 포트 포워딩 설정을 해야 할까? 그렇게 되면 너무 불편한 일이다. 예를 들어 토렌트와 같이 P2P 통신을 사용하는 것들을 사용해 보면 알텐데 이 토렌트를 쓰고 있다고 해서 과연 직접 공유기에 포트 포워딩을 한 적이 있는가?? 아니다 별다른 설정이 없어도 잘 동작한다**.

**왜 그런 것일까?? 보통의 경우 모든 공유기가 UPnP라는 것을 지원한다. Universal PnP라고 UPnP 설정이 기본적으로 자동으로 실행이 되어 있다**.

```
수동 포트 포워딩의 문제점:

사용자 관점의 어려움:
┌─────────────────────────────────────────────────┐
│ 1. 기술적 복잡성:                               │
│   • 공유기 관리 페이지 접속 방법 모름           │
│   • 포트 번호, IP 주소 개념 이해 필요           │
│   • 제조사별 다른 설정 방법                     │
│                                                 │
│ 2. 설정 과정의 번거로움:                        │
│   • 매번 수동으로 포트 개방                     │
│   • 애플리케이션 종료 시 수동으로 포트 닫기     │
│   • 동적 포트 사용 시 설정 불가능               │
│                                                 │
│ 3. 보안 위험:                                   │
│   • 포트를 열어둔 채 방치                       │
│   • 불필요한 포트 개방                          │
│   • 설정 실수로 인한 보안 취약점                │
└─────────────────────────────────────────────────┘

개발자 관점의 문제:
┌─────────────────────────────────────────────────┐
│ 1. 사용자 지원 부담:                            │
│   • 제조사별 설정 가이드 작성                   │
│   • 기술 지원 요청 증가                         │
│   • 설정 실패로 인한 서비스 이용 포기           │
│                                                 │
│ 2. 애플리케이션 제약:                           │
│   • 동적 포트 할당 불가                         │
│   • 실시간 포트 변경 어려움                     │
│   • P2P 기능 구현 복잡성 증가                   │
└─────────────────────────────────────────────────┘

자동화의 필요성:
┌─────────────────────────────────────────────────┐
│ 이상적인 시나리오:                              │
│ • 애플리케이션 실행 → 자동 포트 개방            │
│ • P2P 연결 설정 → 자동 NAT 구성                │
│ • 애플리케이션 종료 → 자동 포트 닫기            │
│ • 사용자는 아무것도 몰라도 됨                   │
└─────────────────────────────────────────────────┘
```

## PnP (Plug and Play) 개념

**UPnP가 무엇인지 설명하기 앞서서 이 PnP가 무엇인지부터 알아야 한다**.

**윈도우 98 시절에 PnP라는 개념이 있었다. 이게 무엇인가 하면 Plug And Play이다. 그니까 갖다 꽂으면 작동한다라는 의미인데 대표적으로 USB가 있다 우리가 USB를 꽂았다가 뽑았다 한다고 해서 PC가 고장 날 걱정을 하지 않는다 마찬가지로 프린터기 역시 그렇다. 즉, 이 PnP 개념이 나오면서 장치만 갖다 꽂으면 그때부터 인터넷까지 연결되어 있으면 윈도우 서버에 가서 드라이버까지 다운로드받아서 설치까지 자동으로 끝내버린다. 그래서 이 PnP가 나오면서부터 운영체제에 어떠한 설정을 하는 일이 획기적으로 줄어들게 된다**.

```
PnP 발전 과정:

PnP 이전 시대 (DOS/Windows 3.1):
┌─────────────────────────────────────────────────┐
│ 하드웨어 설치 과정:                             │
│ 1. 물리적 장치 연결                             │
│ 2. IRQ, DMA, I/O 포트 수동 설정                │
│ 3. CONFIG.SYS, AUTOEXEC.BAT 편집               │
│ 4. 드라이버 디스켓에서 수동 설치                │
│ 5. 시스템 재부팅                                │
│ 6. 충돌 해결을 위한 반복 설정                   │
│                                                 │
│ 문제점:                                         │
│ • 하드웨어 충돌 빈발                            │
│ • 전문 지식 필요                                │
│ • 설치 실패율 높음                              │
└─────────────────────────────────────────────────┘

PnP 시대 (Windows 95/98 이후):
┌─────────────────────────────────────────────────┐
│ 자동화된 설치 과정:                             │
│ 1. 장치 연결                                    │
│ 2. 하드웨어 자동 감지                           │
│ 3. 리소스 자동 할당 (IRQ, DMA 등)              │
│ 4. 드라이버 자동 설치                           │
│ 5. 즉시 사용 가능                              │
│                                                 │
│ 혁신적 변화:                                    │
│ • "갖다 꽂으면 작동" (Zero Configuration)       │
│ • 사용자 개입 최소화                            │
│ • 하드웨어 호환성 향상                          │
└─────────────────────────────────────────────────┘

현대의 PnP (Windows 10/11):
┌─────────────────────────────────────────────────┐
│ 고도화된 자동화:                                │
│ • 인터넷을 통한 자동 드라이버 다운로드          │
│ • Windows Update 연동                          │
│ • 클라우드 기반 하드웨어 데이터베이스           │
│ • 핫플러그 지원 (USB, Thunderbolt)             │
│                                                 │
│ 지원 기술:                                      │
│ • ACPI (Advanced Configuration and Power Interface) │
│ • USB, PCI Express                             │
│ • Bluetooth, Wi-Fi                            │
│ • 모바일 장치 연동                              │
└─────────────────────────────────────────────────┘
```

## Universal PnP (UPnP) 개념

그러면 **Universal PnP는 뭐냐 하면 홈쇼핑을 떠올리면 이해하기가 쉽다. 홈쇼핑에서 쇼호스트가 나와서 광고를 하게 된다. 이때 이 시간에만 리모컨 버튼을 누르게 되면 PC에 연결되어 있는 프린터기에 쿠폰이 발급된다고 했을 때 문제가 NAT로 묶여있으면 이것이 작동하지 않는다. 해당 PC에 접속해서 프린터기에 쿠폰을 인쇄하라고 명령어를 보냈는데 PC에 접근이 안 되니 프린터기가 동작하지 않을 때는 포트 포워딩을 하라고 설명할 수가 없다**.

**그래서 이러한 것들을 자동으로 해주는 규격이 등장했는데 바로 Universal PnP에 포함된 스펙이 SSDP이다. Simple Service Discovery Protocol이다**.

```
UPnP의 배경과 목적:

네트워크 PnP의 필요성:
┌─────────────────────────────────────────────────┐
│ 홈 네트워크 환경의 복잡화:                       │
│ • 다양한 디지털 기기들이 하나의 네트워크에 연결  │
│ • 프린터, 미디어 플레이어, 스마트 TV 등         │
│ • 각 기기 간 상호 작용 필요                     │
│                                                 │
│ NAT 환경의 제약:                                │
│ • 외부에서 내부 기기 직접 접근 불가             │
│ • 서비스 발견 (Service Discovery) 어려움       │
│ • 동적 포트 할당 문제                           │
└─────────────────────────────────────────────────┘

UPnP가 해결하는 문제:
┌─────────────────────────────────────────────────┐
│ 1. 기기 발견 (Device Discovery):                │
│   • 네트워크에 연결된 UPnP 기기 자동 감지       │
│   • IP 주소를 몰라도 서비스 이용 가능           │
│                                                 │
│ 2. 서비스 노출 (Service Advertisement):         │
│   • 각 기기가 제공하는 서비스 자동 광고         │
│   • 기능별 접근 방법 표준화                     │
│                                                 │
│ 3. 자동 설정 (Auto Configuration):              │
│   • 네트워크 설정 자동화                        │
│   • 포트 포워딩 자동 설정                       │
│   • Zero Configuration Networking              │
└─────────────────────────────────────────────────┘

실제 시나리오 예시:
┌─────────────────────────────────────────────────┐
│ 스마트 홈 환경:                                 │
│                                                 │
│ 1. 미디어 서버 (PC):                           │
│   • 음악, 영화 파일 보관                        │
│   • UPnP 미디어 서버 실행                      │
│                                                 │
│ 2. 스마트 TV:                                   │
│   • 네트워크 연결 시 자동으로 미디어 서버 발견  │
│   • 별도 설정 없이 영화 재생 가능               │
│                                                 │
│ 3. 스마트폰:                                    │
│   • 집 안에서 프린터 자동 발견                  │
│   • 드라이버 설치 없이 인쇄 가능                │
└─────────────────────────────────────────────────┘
```

## SSDP와 자동 포트 포워딩

그래서 **토렌트가 SSDP를 지원한다**.

**토렌트를 이용할 때 만약에 공유기가 UPnP를 지원한다고 하면 토렌트가 실행될 때 해당 공유기에 P2P 통신을 해야 되니까 특정 포트 번호를 써야 해 그러니까 설정 자동화 해줄 수 있어? 라고 요청하고 이를 지원하는 공유기가 있으면 응 해줄게~ 라고 해서 이 모든 설정이 자동으로 이루어진다**.

그래서 **SSDP의 핵심은 포트 포워딩의 설정을 자동으로 해줌으로써 P2P 통신을 원활하게 해준다**.

```
SSDP (Simple Service Discovery Protocol) 동작:

토렌트 클라이언트와 공유기 통신:
┌─────────────────────────────────────────────────┐
│ 1. 서비스 발견 (Service Discovery):             │
│                                                 │
│ 토렌트 ─── 멀티캐스트 ──→ 네트워크 전체         │
│         (239.255.255.250:1900)                 │
│         "UPnP 게이트웨이 있나요?"                │
│                                                 │
│ 공유기 ←─── 유니캐스트 ──── 네트워크             │
│         "저 여기 있어요! 포트 포워딩 지원해요"   │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│ 2. 서비스 설명 요청 (Service Description):      │
│                                                 │
│ 토렌트 ──→ HTTP GET ──→ 공유기                  │
│         "어떤 기능들 지원해요?"                  │
│                                                 │
│ 공유기 ←── XML 응답 ←── 토렌트                  │
│         "포트 포워딩, UPnP IGD 지원"            │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│ 3. 포트 포워딩 요청:                            │
│                                                 │
│ 토렌트 ──→ SOAP 요청 ──→ 공유기                │
│         "포트 6881을 내 IP로 포워딩 해주세요"    │
│                                                 │
│ 공유기 ←── SOAP 응답 ←── 토렌트                │
│         "OK, 설정 완료했어요"                   │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│ 4. 자동 정리:                                   │
│                                                 │
│ 토렌트 종료 시:                                 │
│ 토렌트 ──→ SOAP 요청 ──→ 공유기                │
│         "포트 6881 포워딩 해제해 주세요"         │
│                                                 │
│ 또는 TTL(Time To Live) 만료:                   │
│ 공유기가 자동으로 포워딩 규칙 삭제              │
└─────────────────────────────────────────────────┘
```

이러한 **UPnP 기술**을 이해하면 **네트워크 자동화의 편의성과 보안성 간의 균형**을 고려하여 **적절한 네트워크 정책을 수립**할 수 있습니다.