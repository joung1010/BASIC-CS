## PKI 시스템과 인터넷 - 수신한 Key를 신뢰할 수 있는가?

### 공적 증명 시스템의 필요성

메모에서 제시한 우체국 내용증명 비유는 PKI의 핵심 개념을 잘 보여줍니다.

**그래서 이를 해결하기 위해서 우리가 우체국에서 내용증명을 하는 것과 유사한데. 어떤 문서를 보낼 때 동일한 문서를 3개를 만들어서 하나는 내가 다른 하나는 보내는 측이 그리고 마지막 하나를 우체국이 가지고 있게 된다. 그러면 이 문서에 대한 내용이 뭐가 어떻고 그런 것들이 우체국의 증명으로 남아 있다. 여기서 중요한 것은 우체국의 등장이다. 어떤 개인들이 서로간에 대화나 문서를 공적으로 증명받으려고 내용 증명을 하는데 이때 공공기관이 개입해서 이 증명을 대행해준다.**

```
물리 세계 vs 디지털 세계의 신뢰 구조

물리 세계 (우체국 내용증명):
┌─────────────────────────────────┐
│송신자 ←── 문서 1부 ──→ 수신자   │
│  ↓                       ↑     │
│문서 1부                 문서 확인│
│  ↓                             │
│우체국 (공적 기관)              │
│• 문서 내용 보관                │
│• 송수신 사실 증명              │
│• 분쟁 시 공적 증거 제공        │
└─────────────────────────────────┘

디지털 세계 (PKI):
┌─────────────────────────────────┐
│PC ←── 인증서 ──→ 서버           │
│ ↓                      ↑        │
│검증                   인증서     │
│ ↓                             │
│CA (인증기관)                   │
│• 서버 신원 확인 및 증명        │
│• 인증서 발급                   │
│• 디지털 서명으로 보증          │
└─────────────────────────────────┘
```

### 키 생성 비용과 재사용

**이 키에 대한 증명에 앞서 이 키라는 것을 한 쌍을 생성하는 데에는 생각보다 많은 전산 자원이 소비된다. 그러면 여기서 또 매번 키를 생성할 것인가에 대한 문제가 생긴다.**

메모의 젓가락 비유는 키의 경제적 가치를 잘 표현했지만, 보안 관점에서 보완 설명이 필요합니다:

```
키 재사용의 경제성 vs 보안성

경제적 관점 (메모의 젓가락 비유):
┌─────────────────────────────────┐
│일회용 나무젓가락 = 세션키       │
│• 생성 비용: 낮음               │
│• 사용 후 폐기                  │
│                               │
│재사용 금속젓가락 = 서버 키쌍    │
│• 생성 비용: 높음 (RSA-2048)    │
│• 장기간 재사용                 │
│• 경제적 효율성                 │
└─────────────────────────────────┘

보안적 관점에서의 고려사항:
┌─────────────────────────────────┐
│키 재사용의 위험:               │
│• 키 노출 시 장기간 영향        │
│• 암호 분석 공격 누적 위험      │
│• Perfect Forward Secrecy 저해   │
│                               │
│해결책:                         │
│• 적절한 유효기간 설정 (1-2년)  │
│• 키 순환 (Key Rotation)        │
│• 하이브리드 방식 (세션키 병용)  │
└─────────────────────────────────┘
```

**그래서 예전에는 이 한 쌍의 키를 매번 생성을 하다가 이것이 너무 비효율적인 것을 확인했다. 그래서 이 한 쌍의 키를 일정 기간동안 한번만 생성하고 그 기간동안 해당 키를 계속 사용한다.**

### PKI 인증 체계의 구조

메모에서 RA와 CA의 역할 설명에 일부 부정확한 부분이 있어 정정이 필요합니다:

**혹은 매번 이렇게 키를 생성할 수 없으니 새로운 인증 체계 RA(Registration Authority)라고 RA에 가서 한 쌍의 키를 구입한다.**

실제로는 다음과 같은 구조입니다:

```
PKI 체계의 정확한 구조

실제 인증서 발급 과정:
┌─────────────────────────────────┐
│1단계: 키 쌍 생성                │
│• 서버 관리자가 직접 생성        │
│• 또는 CA에서 대행 생성          │
│                               │
│2단계: 인증서 신청 (CSR)        │
│• 공개키 + 서버 정보 → RA       │
│• RA가 신원 확인 및 심사        │
│                               │
│3단계: CA의 인증서 발급         │
│• RA 심사 결과 → CA            │
│• CA가 디지털 서명으로 인증서 발급│
│                               │
│4단계: 인증서 설치              │
│• 발급된 인증서를 서버에 설치   │
│• 개인키와 함께 보관            │
└─────────────────────────────────┘

RA의 실제 역할:
┌─────────────────────────────────┐
│❌ 키를 "판매"하는 기관 아님    │
│✅ 신원 확인 및 등록 대행 기관  │
│                               │
│주요 업무:                      │
│• 신청자 신원 확인              │
│• 서류 심사 및 검토             │
│• CA와 신청자 간 중계           │
│• 인증서 배송 및 설치 지원      │
└─────────────────────────────────┘
```

### X.509 디지털 인증서 구조

**그래서 공개키 + 추가 정보 + 무결성 검사 해시 이렇게 해서 어떤 정보형태로 추가적으로 만드는데 그 형식이 x.509이다. 그래서 이 형식으로 만들어진 형태의 정보를 인증서라고 한다.**

```
X.509 인증서의 상세 구조

인증서 필드 구성:
┌─────────────────────────────────┐
│Version: v3 (현재 표준)         │
│Serial Number: 고유 일련번호    │
│Signature Algorithm: SHA-256    │
│Issuer: CN=VeriSign, C=US       │
│Validity Period: 2024~2025      │
│Subject: CN=example.com         │
│Subject Public Key Info:        │
│  Algorithm: RSA                │
│  Public Key: [2048-bit key]    │
│Extensions:                     │
│  Key Usage: Digital Signature  │
│  Subject Alt Name: *.example.com│
│Certificate Signature:          │
│  [CA의 디지털 서명]            │
└─────────────────────────────────┘

메모의 표현을 정정하면:
❌ "공개키 + 추가정보 + 무결성 해시"
✅ "공개키 + 메타정보 + CA 디지털 서명"
```

### SSL 인증서와 웹 보안

**그래서 이제 이 PC가 어떤 웹서버에게 HTTPS 통신을 요청을 하면 접속하면 그 웹서버에서 퍼블릭키가 오는 것이 아니라 인증서가 날아온다.**

```
HTTPS 연결 시 인증서 교환

SSL/TLS Handshake:
┌─────────────────────────────────┐
│1. Client Hello                 │
│PC → 서버: 지원 암호화 알고리즘  │
│                               │
│2. Server Hello + Certificate   │
│서버 → PC: 선택된 알고리즘 + 인증서│
│                               │
│3. Certificate Verification     │
│PC: 인증서 검증 수행            │
│                               │
│4. Key Exchange                │
│PC → 서버: 암호화된 세션키      │
│                               │
│5. Secure Communication        │
│양방향 암호화 통신 시작         │
└─────────────────────────────────┘

브라우저 인증서 확인 방법:
┌─────────────────────────────────┐
│Chrome 주소창 자물쇠 클릭:      │
│• 인증서 정보 확인              │
│• 발급기관 (CA) 확인            │
│• 유효기간 확인                 │
│• 암호화 알고리즘 확인          │
└─────────────────────────────────┘
```

### 인증서 검증 과정

**SSL 인증서를 검증하는 방법은 인증서를 발급한 CA의 인증서에 포함된 Public Key를 이용해 SSL 인증서 Hash 결과를 복호화하면 된다.**

```
디지털 서명 검증 과정

인증서 검증 메커니즘:
┌─────────────────────────────────┐
│Digital Certification           │
│─────────────────────────────── │
│User Information                │
│Public Key                      │
│Digital Signature of CA         │
│(암호화된 Hash)                 │
└─────────────────────────────────┘
           ↓ 검증 과정
┌─────────────────────────────────┐
│1단계: 인증서 내용 해시 계산     │
│사용자정보 + 공개키 → Hash A     │
│                               │
│2단계: CA 서명 복호화           │
│CA 공개키로 서명 복호화 → Hash B │
│                               │
│3단계: 해시값 비교              │
│Hash A == Hash B → 검증 성공    │
└─────────────────────────────────┘
```

### 신뢰할 수 있는 루트 인증기관

**그래서 윈도우의 경우 certmgr.msc라는 명령어를 입력하면 신뢰할 수 있는 루트 인증서 기관들이라고 해서 인증서 목록들이 나오고 이를 확인할 수 있다.**

```
운영체제 내장 루트 CA

Windows: certmgr.msc
┌─────────────────────────────────┐
│신뢰할 수 있는 루트 인증 기관:   │
│• VeriSign                      │
│• DigiCert                      │
│• GlobalSign                    │
│• Comodo                        │
│• Let's Encrypt                 │
│• 약 200여 개 CA                │
└─────────────────────────────────┘

신뢰 체인 검증:
┌─────────────────────────────────┐
│루트 CA (OS 내장)               │
│    ↓ 서명                      │
│중간 CA                        │
│    ↓ 서명                      │
│서버 인증서                     │
│                               │
│전체 체인 검증 → 신뢰 결정      │
└─────────────────────────────────┘
```

### 한국의 PKI 인증 체계

메모 마지막 부분의 한국 PKI 구조는 정확하지만 일부 기관명이 현재와 다릅니다:

```
한국 PKI 체계 (현재 기준)

계층 구조:
┌─────────────────────────────────┐
│PA (정책승인기관)               │
│• 과학기술정보통신부            │
│                               │
│PCA (정책인증기관)              │
│• KISA (한국인터넷진흥원)       │
│                               │
│CA (인증기관)                   │
│• 금융결제원 (yessign)          │
│• 한국정보인증 (signkorea)      │
│• 코스콤                        │
│                               │
│RA (등록기관)                   │
│• 은행, 증권사 등               │
└─────────────────────────────────┘

특징:
✅ 정부 주도의 공인인증서 체계
✅ 금융 서비스 중심 발전
✅ 최근 민간 인증서 활성화
```

이렇게 PKI 시스템은 **중간자 공격을 방지하고 공개키의 신뢰성을 보장**하는 인터넷 보안의 핵심 인프라입니다. **우체국 내용증명과 같은 공적 보증 시스템**을 디지털 세계에 구현하여 현재 모든 웹 보안의 기반이 되고 있습니다.