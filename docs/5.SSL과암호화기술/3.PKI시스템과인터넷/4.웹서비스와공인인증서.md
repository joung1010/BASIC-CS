## 웹서비스와 공인인증서

### 웹 서버 아키텍처와 SSL 인증서 배치

메모에서 제시한 웹 서버 구조도를 분석해보겠습니다:

```
웹 서비스 3-Tier 아키텍처

       <Public>                  WEB    WAS    DB
PC ----- 인터넷 ------   SSL     Server Server Server
                    |        |
                    |        |
 <     HTTPS     >  |   DMZ  |  <          HTTP        >
                    |        |  <          HTTPS       >
                    |        |
```

### SSL 인증서 설치 위치 분석

**Web Server의 망구성도를 보고 이를 분석해야 할 때가 있는데 그때 SSL 인증서를 잘 보면 된다. SSL 인증서가 어디에 설치되었는지를 찾으면 된다. 그러면 이 구조를 분석하는 데 많은 도움이 된다.**

```
SSL 인증서 배치 패턴 분석

패턴 1: WAF/Load Balancer에서 SSL 종료
┌─────────────────────────────────┐
│인터넷 ←→ WAF/LB ←→ 웹서버 ←→ WAS│
│(HTTPS)   (SSL 인증서)   (HTTP)  │
│                                │
│특징:                           │
│• SSL 복호화 부담 집중 처리     │
│• 내부 통신은 평문 가능         │
│• 성능 최적화                   │
└─────────────────────────────────┘

패턴 2: 웹서버에서 SSL 종료
┌─────────────────────────────────┐
│인터넷 ←→ 웹서버 ←→ WAS ←→ DB    │
│(HTTPS) (SSL 인증서) (HTTP)      │
│                                │
│특징:                           │
│• 전통적인 방식                 │
│• 웹서버가 암호화 부담          │
└─────────────────────────────────┘

패턴 3: End-to-End 암호화
┌─────────────────────────────────┐
│인터넷 ←→ WAF ←→ 웹서버 ←→ WAS   │
│(HTTPS) (재암호화) (HTTPS)       │
│                                │
│특징:                           │
│• 내부 통신까지 암호화          │
│• 최고 보안 수준                │
│• 성능 오버헤드 존재            │
└─────────────────────────────────┘
```

### DMZ와 보안 구간 이해

**보통 웹서비스를 이루고 있는 맨 앞단에 있는 웹서버가 있고 중간에 WAS가 있고 맨 마지막에 DB가 있다. 그래서 실제 웹서비스에 접속하려면 누구든지 인터넷 퍼블릭 영역을 거쳐서 접속해야 한다. 근데 이때 같은 네트워크이지만 외부를 위해 열려진 공간 이 공간을 흔히 DMZ라고 한다.**

```
네트워크 보안 구간 설계

전체 네트워크 아키텍처:
┌─────────────────────────────────┐
│     인터넷 (Untrusted)          │
│            ↕                   │
│     외부 방화벽                 │
│            ↕                   │
│     DMZ (Semi-trusted)          │
│   • 웹서버                     │
│   • WAF                        │
│   • Load Balancer              │
│            ↕                   │
│     내부 방화벽                 │
│            ↕                   │
│     내부망 (Trusted)            │
│   • WAS 서버                   │
│   • 데이터베이스               │
│   • 내부 시스템                │
└─────────────────────────────────┘

DMZ의 역할:
✅ 외부 접근 허용 영역
✅ 내부망과 격리
✅ 추가 보안 장치 배치
✅ 공격 영향 최소화
```

### WAF와 보안 장치 배치

**이 DMZ 구간에 보통 WAF(Web Application Firewall) 같은 보안 체계를 해당 구간에 놔두게 된다. 그래서 보통의 경우 인증서가 이 DMZ 구간에 올라가게 된다.**

```
WAF와 SSL 인증서의 관계

WAF에서 SSL 처리 시:
┌─────────────────────────────────┐
│클라이언트                      │
│    ↓ HTTPS (암호화)            │
│WAF (SSL 인증서 설치)           │
│    ↓ 복호화/검사/재암호화      │
│웹서버                          │
│                                │
│WAF 기능:                       │
│• SSL/TLS 종료                  │
│• 애플리케이션 레벨 필터링      │
│• SQL 인젝션 차단               │
│• XSS 공격 방어                 │
│• DDoS 방어                     │
└─────────────────────────────────┘

인증서 관리 관점:
┌─────────────────────────────────┐
│집중화 장점:                    │
│• 인증서 갱신 단순화            │
│• 암호화 성능 최적화            │
│• 보안 정책 중앙 관리           │
│                                │
│고려 사항:                      │
│• Single Point of Failure       │
│• 성능 병목 가능성              │
│• 내부 통신 보안 별도 고려      │
└─────────────────────────────────┘
```

### 티어 구조의 다양성

**항상 그런 건 아니고 어떤 곳은 웹서버와 WAS가 하나로 운영되는 곳도 있고 이 둘이 각각 독립적으로, 티어로 구성되어 있을 수도 있다.**

```
웹 아키텍처 패턴별 SSL 배치

1-Tier (All-in-One):
┌─────────────────────────────────┐
│통합 서버 (웹+WAS+DB)            │
│• SSL 인증서: 통합 서버에 설치  │
│• 관리 단순함                   │
│• 확장성 제한                   │
└─────────────────────────────────┘

2-Tier (웹서버 + WAS+DB):
┌─────────────────────────────────┐
│웹서버 ←→ WAS+DB                │
│• SSL: 웹서버 또는 WAF          │
│• 중소 규모 일반적              │
└─────────────────────────────────┘

3-Tier (웹+WAS+DB 분리):
┌─────────────────────────────────┐
│웹서버 ←→ WAS ←→ DB              │
│• SSL: 웹서버, WAF, 또는 LB     │
│• 대규모 서비스 표준            │
│• 각 티어별 전문화              │
└─────────────────────────────────┘

Microservices:
┌─────────────────────────────────┐
│API Gateway ←→ 서비스들          │
│• SSL: API Gateway에서 처리     │
│• 서비스간 mTLS 적용 가능       │
└─────────────────────────────────┘
```

### 공인인증서와 SSL 인증서의 구분

메모 후반부에서 공인인증서 설명이 나오는데, 이는 SSL 인증서와는 다른 용도입니다:

**어떤 서버가 있으면 그 서버에 접속하는 측에서 서버에서 받은 퍼블릭키를 검증을 했다 근데 이에 다른 말은 인증이다.**

```
인증서 유형별 용도 구분

SSL 인증서 (서버 인증):
┌─────────────────────────────────┐
│목적: 서버 신원 확인            │
│• 웹사이트가 진짜인지 확인      │
│• 통신 채널 암호화              │
│• 브라우저 주소창 자물쇠 표시   │
│                                │
│설치 위치: 웹서버/WAF/LB        │
│사용자 개입: 자동 (브라우저)    │
└─────────────────────────────────┘

공인인증서 (클라이언트 인증):
┌─────────────────────────────────┐
│목적: 사용자 신원 확인          │
│• 본인 확인 및 전자서명         │
│• 금융 거래 승인                │
│• 전자문서 서명                 │
│                                │
│설치 위치: 사용자 PC/휴대폰     │
│사용자 개입: 수동 (인증서 선택) │
└─────────────────────────────────┘
```

### 금융권 PKI 생태계

**만약에 검증의 주체가 은행이라면, 예를 들어 우리가 우리은행 같은 곳에서 인증서를 발급받을 수 있다. 그러면 이 은행이 기본적으로 RA의 역할을 하게 되는 거고 이 은행과 제휴를 맺은 CA가 존재할 것이다.**

```
한국 금융권 PKI 구조

금융 PKI 생태계:
┌─────────────────────────────────┐
│        KISA (정책인증기관)      │
│               ↓                │
│     금융결제원 (yessign CA)     │
│               ↓                │
│ ┌─────────┬─────────┬─────────┐ │
│ │우리은행 │ KB국민  │신한은행 │ │
│ │  (RA)  │  (RA)  │  (RA)  │ │
│ └─────────┴─────────┴─────────┘ │
│               ↓                │
│          개인 사용자            │
└─────────────────────────────────┘

상호 인정 체계:
✅ 동일 CA 발급 = 상호 사용 가능
✅ 우리은행 발급 → KB에서도 인정
✅ 신한은행 발급 → 모든 금융기관 인정
```

### 인증의 목적과 암호화의 목적

**그래서 이때는 어떤 암호화 통신이 목적이 아니라 이러한 인증 체계는 인증 그 자체가 목적이다.**

```
SSL vs 공인인증서 목적 비교

SSL 인증서:
┌─────────────────────────────────┐
│주목적: 통신 보안               │
│• 데이터 암호화 (기밀성)        │
│• 서버 신원 확인 (인증)         │
│• 데이터 무결성 (변조 방지)     │
│                                │
│부수효과: 사용자 신뢰 확보      │
└─────────────────────────────────┘

공인인증서:
┌─────────────────────────────────┐
│주목적: 사용자 인증             │
│• 본인 확인 (신원 인증)         │
│• 전자서명 (부인 방지)          │
│• 법적 효력 (전자서명법)        │
│                                │
│부수효과: 통신 구간 암호화      │
└─────────────────────────────────┘

상호 보완 관계:
✅ SSL: 서버 → 클라이언트 인증
✅ 공인인증서: 클라이언트 → 서버 인증
✅ 양방향 인증으로 완전한 보안
```

이렇게 웹 서비스에서 SSL 인증서의 배치 위치는 **시스템 아키텍처와 보안 요구사항**에 따라 결정되며, **공인인증서는 별도의 사용자 인증 체계**로서 SSL과 함께 **양방향 보안**을 구성합니다. DMZ에서의 SSL 종료는 **성능과 보안의 균형**을 맞추는 일반적인 패턴입니다.