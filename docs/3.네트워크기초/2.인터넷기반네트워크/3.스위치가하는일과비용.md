## 스위치가 하는일과 비용

### 네트워크와 고속도로의 유사성

**이 네트워크는 흔히 고속도로 망과 매우 흡사합니다.** 차량을 가지고 출발지에서 운전을 하고 목적지까지 이동을 하는데 있어서 굳이 고속도로가 아니더라도 시내에서 운전을 하다 보면 흔히 교차로라는 곳을 만나게 됩니다.

**이 교차로에서 우리는 목적지를 향해서 우회전 또는 좌회전, 혹은 직진을 할 수 있습니다. 이처럼 목적지를 향해 경로를 선택하여 나아가야 되는데 이 선택에 대한 근거를 기반으로 선택합니다.** 운전할 때도 지도를 보고 최단 경로에 따라서 직진할지 우회전할지 좌회전할지와 같이 결정하는 것처럼. **만약 지도가 존재하지 않는다면 이정표를 보고 따라갔을 것입니다.**

### 스위칭(Switching)의 개념

**그러면 이제 이 도로를 네트워크, 인터넷이라고 생각해보면, 이 교차로가 스위치입니다. 우리가 도로에서 방향을 선택하여 나아가듯이 네트워크에서는 인터페이스를 선택합니다. 이를 다른 말로는 스위칭이라고 합니다.**

```
도로 비유           →  네트워크 실제
──────────────────────────────────────
도로               →  네트워크/인터넷
교차로             →  스위치
자동차             →  패킷
이정표             →  라우팅 테이블
방향 선택          →  스위칭
운전자의 판단      →  스위칭 알고리즘
```

### 계층별 스위칭 방식

### L3 스위칭 (IP 기반)

**그러면 선택의 근거가 이정표라고 했는데 인터넷, 네트워크라는 도로망에서 IP 주소를 근거로 해서 스위칭했다라고 한다면 이는 IP는 네트워크 계층 L3에 속해있고 이러한 스위칭을 L3 스위칭이라고 합니다.**

```
L3 스위칭 동작 과정:

패킷 도착
    ↓
목적지 IP 주소 확인 (예: 192.168.1.100)
    ↓
라우팅 테이블 검색
┌─────────────────────────────────────────┐
│ 목적지 네트워크  │ 게이트웨이  │ 인터페이스 │
├─────────────────────────────────────────┤
│ 192.168.1.0/24  │ 직접연결   │ eth0      │
│ 10.0.0.0/8      │ 10.0.0.1   │ eth1      │
│ 0.0.0.0/0       │ 203.0.113.1│ eth2      │
└─────────────────────────────────────────┘
    ↓
적절한 인터페이스로 패킷 전달
```

**그러면 이때 자동차는 하나의 단위가 되고 인터넷이라면 이 단위를 패킷이라고 합니다. 이때 L3의 교차로를 인터넷에서는 라우터라고 합니다.**

### 라우팅 테이블의 역할

**그래서 이 라우터마다 이정표가 들어 있는데 그 이정표가 라우팅 테이블입니다.**

```
라우터의 역할 세분화:

1. 패킷 수신 및 분석
   ┌─────────┐
   │ 패킷 도착 │ → IP 헤더의 목적지 IP 확인
   └─────────┘

2. 라우팅 테이블 검색  
   ┌─────────────────┐
   │ 이정표 확인      │ → 최적 경로 탐색
   │ (라우팅 테이블)  │
   └─────────────────┘

3. 최적 경로 결정
   ┌─────────────────┐
   │ 비용 계산        │ → Metric 값 비교
   │ (Metric)        │
   └─────────────────┘

4. 패킷 전달
   ┌─────────────────┐
   │ 인터페이스 선택  │ → 다음 홉으로 전송
   └─────────────────┘
```

### 기타 계층의 스위칭

**만약 MAC 주소를 기반으로 스위칭하면 L2 스위치가 됩니다. 포트 번호를 가지고 스위칭한다 그러면 L4 스위치입니다. HTTP 프로토콜을 기준으로 스위칭한다 그러면 L7 스위치입니다.**

```
계층별 스위칭 비교:

L2 스위치 (MAC 기반)
├─ 판단 기준: MAC 주소 (00:1B:44:11:3A:B7)
├─ 동작 범위: 같은 네트워크 세그먼트 내
├─ 대표 장비: 일반 스위치, 브리지
└─ 예시: 사무실 내부 PC들 연결

L4 스위치 (Port 기반)  
├─ 판단 기준: TCP/UDP 포트 번호 (80, 443, 22)
├─ 동작 범위: 전송 계층 기반 로드밸런싱
├─ 대표 장비: 로드밸런서, 방화벽
└─ 예시: 웹서버 트래픽 분산

L7 스위치 (Application 기반)
├─ 판단 기준: HTTP 헤더, URL, 쿠키
├─ 동작 범위: 애플리케이션 레벨 지능형 분산  
├─ 대표 장비: ADC, WAF, API Gateway
└─ 예시: /api/* → API서버, /static/* → CDN
```

### 네트워크 비용과 Metric 개념

**우리가 운전을 하면서도 목적지에 도달하기까지 여러 길을 통해 도달할 수 있는데 네트워크에서도 스위치를 거쳐서 목적지에 도달할 때 중요한 이정표 중 하나가 비용입니다.**

**만약에 직진 또는 우회전을 선택해서 다른 스위치를 경유해서 목적지에 도달할 수 있다고 가정했을 때 직진은 100의 비용이 우회전은 50의 비용이 든다 했을 때 당연히 50의 비용이 드는 쪽으로 선택해야 합니다. 이때 이 비용을 Metric이라고 합니다. 이 Metric 값이 비용입니다. 그래서 이 Metric 값이 낮은 쪽으로 이동하게 되어 있습니다.**

### Metric 값 결정 요소

```
Metric 계산에 영향을 주는 요소들:

1. 홉 카운트 (Hop Count)
   ┌─────────────────────────────────┐
   │ A → R1 → R2 → B (3홉)          │
   │ A → R3 → B      (2홉) ← 선택    │
   └─────────────────────────────────┘

2. 대역폭 (Bandwidth)  
   ┌─────────────────────────────────┐
   │ 경로1: 100Mbps → Metric = 1000  │
   │ 경로2: 1Gbps   → Metric = 100 ← 선택│
   └─────────────────────────────────┘

3. 지연시간 (Delay)
   ┌─────────────────────────────────┐
   │ 경로1: 10ms → Metric = 10       │  
   │ 경로2: 50ms → Metric = 50       │
   └─────────────────────────────────┘

4. 신뢰성 (Reliability)
   ┌─────────────────────────────────┐
   │ 경로1: 99.9% 가용성             │
   │ 경로2: 95.0% 가용성             │
   └─────────────────────────────────┘

5. 로드 (Load)
   ┌─────────────────────────────────┐
   │ 경로1: 사용률 80% → 높은 Metric  │
   │ 경로2: 사용률 20% → 낮은 Metric ← 선택│
   └─────────────────────────────────┘
```

### 동적 라우팅 프로토콜별 Metric

```
주요 라우팅 프로토콜의 Metric 계산:

RIP (Routing Information Protocol)
├─ Metric: 홉 카운트만 사용
├─ 최대 15홉까지 허용
└─ 단순하지만 최적 경로 보장 어려움

OSPF (Open Shortest Path First)  
├─ Metric: 대역폭 기반 (Cost = 100,000,000 / 대역폭)
├─ 100Mbps → Cost = 1000
├─ 1Gbps   → Cost = 100  
└─ 링크 상태 기반으로 정확한 토폴로지 유지

EIGRP (Enhanced Interior Gateway Routing Protocol)
├─ Metric: 대역폭 + 지연시간 + 신뢰성 + 로드
├─ 복합 계산식으로 정밀한 경로 선택
└─ 빠른 수렴과 루프 방지 기능
```

### 실제 라우팅 테이블 확인

**그래서 실제 컴퓨터에서 이 라우팅 테이블을 확인할 수 있습니다.**

### Windows에서 라우팅 테이블 확인

```
cmd
route PRINT

결과 예시:
═══════════════════════════════════════════════════════════════════════
활성 라우팅:
네트워크 대상      넷마스크        게이트웨이       인터페이스       메트릭
0.0.0.0           0.0.0.0         192.168.1.1     192.168.1.100    25
127.0.0.0         255.0.0.0       켜져 있음        127.0.0.1         1
192.168.1.0       255.255.255.0   켜져 있음        192.168.1.100     25
192.168.1.100     255.255.255.255 켜져 있음        127.0.0.1         25
═══════════════════════════════════════════════════════════════════════

해석:
- 0.0.0.0/0: 모든 목적지 → 기본 게이트웨이(192.168.1.1)로
- 192.168.1.0/24: 로컬 네트워크 → 직접 연결
- 127.0.0.0/8: 루프백 주소 → 내부 처리
```

### Linux/Mac에서 라우팅 테이블 확인

```
$ netstat -rn
또는
$ route -n

결과 예시:
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.1.1     0.0.0.0         UG    100    0        0 eth0
192.168.1.0     0.0.0.0         255.255.255.0   U     100    0        0 eth0
```

### 실제 패킷 전달 시나리오

```
웹사이트 접속 시 패킷 이동 경로:

사용자 PC (192.168.1.100)
    ↓ 목적지: 8.8.8.8 (구글 DNS)
집 라우터 (192.168.1.1)
    ↓ Metric 계산 → 최적 경로 선택
ISP 라우터 1 (203.0.113.1)
    ↓ 라우팅 테이블 검색
ISP 라우터 2 (203.0.113.10)  
    ↓ 비용 고려한 경로 선택
인터넷 백본 라우터들...
    ↓ 각 홉마다 최적 경로 계산
구글 DNS 서버 (8.8.8.8)

각 단계에서:
1. 목적지 IP 확인
2. 라우팅 테이블 검색  
3. Metric 값 비교
4. 최적 경로로 전달
```

이처럼 **네트워크는 실제로 고속도로와 매우 유사한 구조**로 동작하며, **각 라우터가 교차로 역할을 하면서 최적의 경로를 선택**하여 데이터를 전달하는 지능적인 시스템입니다.