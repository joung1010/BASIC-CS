### Packet의 기본 개념

**Packet은 기본적으로 어떤 단위 데이터입니다. 즉 어떤 데이터를 감싸서 하나의 단위 데이터로 만들었다는 것이 핵심입니다.**

### 계층별 데이터 단위 구분

```
네트워크 계층별 데이터 단위:

L1 (Physical):   Bit/Signal
                 ├─ 전기 신호
                 ├─ 광 신호  
                 └─ 전자기파

L2 (Data Link):  Frame
                 ├─ 이더넷 프레임
                 ├─ 최대 1518바이트
                 └─ MAC 주소 기반

L3 (Network):    Packet ← 핵심!
                 ├─ IP 패킷
                 ├─ 최대 MTU 크기
                 └─ IP 주소 기반
```

**Packet이라는 말은 L3 IP packet으로 기억하자. 실제로는 packet이라고만 쓰는데 이 packet을 들었을 때 자동적으로 L3 네트워크 계층에 식별자는 IP, 전송 데이터는 packet이 떠올릴 수 있게.**

### Packet의 구조적 특성

### Header와 Payload의 상대적 관계

**이 packet은 크게 Header와 Payload로 나뉘며 이는 상대적인 분류입니다. 앞서 Frame도 이와 비슷한 형태이며 Frame과 다르게 packet은 이 크기가 매우 중요합니다.**

```
계층별 Header/Payload 관계:

상위 계층 관점:
┌─────────────────────────────────────┐
│         HTTP 메시지                 │ ← L7 데이터
└─────────────────────────────────────┘
                ↓ 캡슐화
┌─────────┬───────────────────────────┐
│TCP Header│    HTTP 메시지 (Payload)  │ ← L4에서 보는 관점
└─────────┴───────────────────────────┘
                ↓ 캡슐화  
┌─────────┬───────────────────────────┐
│IP Header│  TCP 전체 (Payload)       │ ← L3에서 보는 관점
└─────────┴───────────────────────────┘
                ↓ 캡슐화
┌─────────┬───────────────────────────┐
│Eth Header│   IP 전체 (Payload)      │ ← L2에서 보는 관점
└─────────┴───────────────────────────┘

상대적 특성:
- L3에서: IP Header + TCP+HTTP (Payload)
- L4에서: TCP Header + HTTP (Payload)  
- L7에서: HTTP Header + 실제 데이터 (Payload)
```

### MTU(Maximum Transmission Unit)의 중요성

**Packet의 최대 크기는 MTU(Maximum Transmission Unit)입니다. 기본적으로는 1500바이트(1.4KB) 정도입니다.**

### MTU 크기 제약과 현실

```
표준 MTU 크기:

Ethernet MTU: 1500 bytes
┌─────────┬───────────────────────────┐
│IP Header│         Payload           │
│(20 bytes)│      (1480 bytes)        │
└─────────┴───────────────────────────┘
<─────────── 1500 bytes ──────────────>

실제 IP 패킷 구조:
┌────┬────┬────┬────┬─────────────────┐
│Ver │IHL │ToS │Len │                 │
├────┼────┼────┼────┤    Payload      │
│ID  │Flags│Frag│TTL │   (1480 bytes)  │
├────┼────┼────┼────┤                 │
│Pro │Checksum│Src IP│                 │  
├────┴────────┴────┴─┤                 │
│   Destination IP   │                 │
└────────────────────┴─────────────────┘
    20 bytes Header      최대 1480 bytes

다양한 네트워크의 MTU:
├─ Ethernet: 1500 bytes (가장 일반적)
├─ PPPoE: 1492 bytes (ADSL 연결)  
├─ 점보 프레임: 9000 bytes (고성능 네트워크)
├─ Token Ring: 4464 bytes (레거시)
└─ 루프백: 65536 bytes (내부 통신)
```

**현재 사회에서 이 정도 크기로는 보낼 수 있는 데이터가 많지 않습니다. 그래서 이 packet을 전체 퍼즐의 하나의 조각 하나라고 생각하면 이해하기 쉽습니다.**

### 패킷 분할(Fragmentation)의 필요성

```
대용량 데이터 전송 시나리오:

10MB 이미지 파일 전송:
원본 파일: 10,485,760 bytes

MTU 1500 bytes로 분할:
┌─────────────────────────────────────┐
│ 패킷 수: 10,485,760 ÷ 1480 ≈ 7,084개 │
│                                     │
│ 패킷 1: [Header][1480 bytes 데이터] │
│ 패킷 2: [Header][1480 bytes 데이터] │
│ 패킷 3: [Header][1480 bytes 데이터] │
│   ...                               │
│ 패킷 7084: [Header][나머지 데이터]   │
└─────────────────────────────────────┘

퍼즐 조각 비유:
- 각 패킷 = 퍼즐 한 조각
- 순서 번호 = 조각 위치 정보
- 목적지에서 재조립 = 퍼즐 완성
- 하나라도 분실 = 전체 그림 깨짐
```

### Header와 Payload의 역할

**그래서 항상 이러한 단위 데이터는 header라고 하는 출발지 목적지 정보와 이 헤더가 실어 나르는 대상을 payload라고 합니다.**

### IP Header의 세부 구조

```
IPv4 Header 상세 분석 (20 bytes):

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├─────────────┬─────────────────┬───────────────────────────────────┤
│Version(4bit)│IHL(4bit)        │Type of Service(8bit)              │
├─────────────┴─────────────────┼───────────────────────────────────┤
│Total Length(16bit)            │Identification(16bit)              │
├───────────────────────────────┼─────────┬─────────────────────────┤
│Flags(3bit)                    │Fragment Offset(13bit)             │
├─────────────┬─────────────────┼─────────┴─────────────────────────┤
│TTL(8bit)    │Protocol(8bit)   │Header Checksum(16bit)             │
├─────────────┴─────────────────┼───────────────────────────────────┤
│Source IP Address(32bit)                                           │
├───────────────────────────────────────────────────────────────────┤
│Destination IP Address(32bit)                                      │
└───────────────────────────────────────────────────────────────────┘

주요 필드 설명:
- Version: IP 버전 (4 = IPv4, 6 = IPv6)
- IHL: Header 길이 (옵션 포함 시 가변)
- Total Length: 전체 패킷 크기 (Header + Payload)
- TTL: 생존 시간 (라우터 홉 제한)  
- Protocol: 상위 프로토콜 (6=TCP, 17=UDP)
- Source/Dest IP: 출발지/목적지 주소
```

### Payload의 다양한 내용

```
IP Payload의 종류:

TCP 세그먼트:
┌─────────┬─────────────────────┐
│IP Header│TCP Header + Data    │
└─────────┴─────────────────────┘
- 신뢰성 있는 연결 지향 통신
- HTTP, HTTPS, FTP, SSH 등

UDP 데이터그램:  
┌─────────┬─────────────────────┐
│IP Header│UDP Header + Data    │
└─────────┴─────────────────────┘
- 빠른 비연결 지향 통신
- DNS, DHCP, 스트리밍 등

ICMP 메시지:
┌─────────┬─────────────────────┐
│IP Header│ICMP Message         │
└─────────┴─────────────────────┘
- 네트워크 진단 및 오류 보고
- ping, traceroute 등

기타 프로토콜:
- GRE (터널링)
- IPSec (보안)  
- OSPF (라우팅)
```

### Wireshark를 통한 Packet 분석

**그러면 이 packet을 실제로 볼 수는 없을까? Wireshark라는 프로그램을 통해 packet을 감청할 수 있습니다.**

### Wireshark 활용법

```
Wireshark 패킷 캡처 예시:

실시간 패킷 모니터링:
┌─────────────────────────────────────────────────┐
│ No. │ Time   │ Source      │ Destination │ Info  │
├─────┼────────┼─────────────┼─────────────┼───────┤
│  1  │ 0.000  │ 192.168.1.10│ 8.8.8.8     │ DNS   │
│  2  │ 0.001  │ 8.8.8.8     │ 192.168.1.10│ DNS   │  
│  3  │ 0.010  │ 192.168.1.10│ 142.250.1.1 │ HTTP  │
│  4  │ 0.015  │ 142.250.1.1 │ 192.168.1.10│ HTTP  │
└─────┴────────┴─────────────┴─────────────┴───────┘

패킷 상세 분석:
Frame 85: 1514 bytes on wire
Ethernet II, Src: aa:bb:cc:dd:ee:ff, Dst: 11:22:33:44:55:66
Internet Protocol Version 4, Src: 192.168.1.10, Dst: 8.8.8.8
    Version: 4
    Header Length: 20 bytes  
    Total Length: 84
    Identification: 0x1234
    Time to live: 64
    Protocol: UDP (17)
User Datagram Protocol, Src Port: 53124, Dst Port: 53
Domain Name System (query)

실제 헥스 덤프:
0000   11 22 33 44 55 66 aa bb cc dd ee ff 08 00 45 00
0010   00 54 12 34 40 00 40 11 b1 e6 c0 a8 01 0a 08 08
0020   08 08 cf 44 00 35 00 40 fe 89 ...
```

### 패킷 분석의 실무 활용

```
네트워크 문제 해결:

1. 연결 문제 진단:
├─ TCP 3-way handshake 확인
├─ SYN, SYN-ACK, ACK 패킷 추적
└─ 연결 실패 원인 파악

2. 성능 문제 분석:
├─ RTT (Round Trip Time) 측정
├─ 패킷 손실률 계산  
├─ 재전송 패킷 확인
└─ 대역폭 사용률 분석

3. 보안 이슈 탐지:
├─ 비정상 트래픽 패턴 발견
├─ DDoS 공격 징후 포착
├─ 악성코드 통신 추적  
└─ 데이터 유출 모니터링

4. 프로토콜 학습:
├─ 실제 프로토콜 동작 관찰
├─ 헤더 구조 직접 확인
├─ 표준 vs 실제 구현 비교
└─ 네트워크 개념 이해 심화
```

### 패킷 캡처 시 주의사항

```
Wireshark 사용 시 고려사항:

법적/윤리적 측면:
├─ 자신의 네트워크에서만 사용
├─ 회사 정책 준수 필요
├─ 개인정보 보호 주의
└─ 패킷 캡처 권한 확인

기술적 측면:
├─ 프로미스큐어스 모드 필요
├─ 스위치 환경에서 제한적  
├─ TAP이나 포트 미러링 활용
└─ 암호화된 트래픽 분석 한계

성능 영향:
├─ 고속 네트워크에서 패킷 손실 가능
├─ 필터링으로 필요한 트래픽만 캡처
├─ 저장 공간 관리 필요
└─ CPU/메모리 사용량 주의
```

이렇게 **Packet은 네트워크 통신의 기본 단위**이며, **MTU 제약으로 인한 분할과 재조립**, 그리고 **Wireshark 같은 도구를 통한 실제 분석**을 통해 네트워크 동작을 깊이 있게 이해할 수 있습니다!